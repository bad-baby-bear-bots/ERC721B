# ERC721B

An improvement on the [ERC721A](https://github.com/chiru-labs/ERC721A) 
implementation. [Read more](https://www.badbabybearbots.com/erc721b.html).

Everything that works in **ERC721** still works in **ERC721B** and 
**ERC721B** includes the following extensions.

 - **ERC721BBurnable** - Ability for owners to burn tokens
 - **ERC721BPausable** - Ability for admins to pause the contract
 - **ERC721BTotalSupply** - Implementation of `totalSupply`
 - **ERC721BURIBase** - Ability to set a base URI for tokens where token URIs dynamically determined
 - **ERC721BURIStorage** - Ability to attach a fixed URI to tokens
 - **ERC721BURIContract** - Allows the contract itself to have a URI

## 1. Install

```bash
$ npm i --save-dev erc721b
```

## 2. Usage

A basic example on how to inherit the ERC721B in your contract would 
look like the following.

```solidity
import "@openzeppelin/contracts/access/Ownable.sol";
import "erc721b/contracts/ERC721B.sol";

contract MyCollection is ERC721B, Ownable {

  constructor(string memory name_, string memory symbol_) ERC721B(name_, symbol_) {}

  function mint(address to, uint256 quantity) external onlyOwner {
    _safeMint(to, quantity);
  }
}
```

See [presets](https://github.com/badbabybearbots/ERC721B/tree/main/contracts/presets)
for more examples. An example of how to do provenance could look like the following.

```solidity
import "erc721b/contracts/presets/ERC721BPresetProvenance.sol";

contract ERC721BMockProvenance is ERC721BPresetProvenance {
  uint256 constant public SALE_PRICE = 0.08 ether;
  uint64 constant public SALE_START_DATE = 1893456000;
  uint8 constant public SALE_MAX_PURCHASE = 1;
  uint256 constant public WHITELIST_PRICE = 0.08 ether;
  uint64 constant public WHITELIST_START_DATE = 1924992000;
  uint8 constant public WHITELIST_MAX_PURCHASE = 5;

  constructor(string memory uri, string memory cid) ERC721BPresetProvenance(
    // name
    "MyCollection", 
    // symbol
    "MYC",
    // base URI
    uri,
    // provenance hash
    cid,
    //MAX_SUPPLY
    10000,
    //white list info 
    WHITELIST_PRICE,
    WHITELIST_START_DATE,
    WHITELIST_MAX_PURCHASE,
    //sale info
    SALE_PRICE,
    SALE_START_DATE,
    SALE_MAX_PURCHASE
  ) {}
}
```

## 3. Auditing

Clone this repo in terminal and `cd` to that folder. Run the following 
commands.

```bash
$ cp .env.sample to .env
$ npm install
```

Sign up to [CoinmarketCap](https://pro.coinmarketcap.com/signup) and 
generate an API key. In `.env` to set the `BLOCKCHAIN_CMC_KEY` to your 
API key.

## 4. Testing

Make sure in `.env` to set the `BLOCKCHAIN_NETWORK` to `hardhat`.

```bash
$ npm test
```

## 5. Reports

We've measured the gas costs and prices for minting, comparing 
OpenZeppelin's **ERC721** vs **ERC721A** vs **ERC721B**. In our 
measurements, the same application-level logic is used.

<pre>
·------------------|------------------|------------------|------------------·
|                  ·           ERC721 ·          ERC721A ·          ERC721B |
...................|..................|..................|...................
|           Deploy |        1,208,218 |        1,210,541 |        1,054,413 |
...................|..................|..................|...................
|           Mint 1 |           56,842 |           56,890 |           56,578 |
...................|..................|..................|...................
|           Mint 2 |           82,424 |           59,149 |           58,595 |
...................|..................|..................|...................
|           Mint 3 |          108,006 |           61,408 |           60,612 |
...................|..................|..................|...................
|           Mint 4 |          133,588 |           63,667 |           62,629 |
...................|..................|..................|...................
|           Mint 5 |          159,170 |           65,926 |           64,646 |
...................|..................|..................|...................
|         Transfer |           62,491 |           66,389 |           66,193 |
...................|..................|..................|...................
|             Burn |           19,611 |           47,380 |           57,262 |
·------------------|------------------|------------------|------------------·
</pre>

The following example is an example cost conversion from the gas above
in USD.

<pre>
·------------------|------------------|------------------|------------------·
|                  ·           ERC721 ·          ERC721A ·          ERC721B |
...................|..................|..................|...................
|           Deploy | $       1,087.39 | $       1,089.48 | $         948.97 |
...................|..................|..................|...................
|           Mint 1 | $          51.15 | $          51.20 | $          50.92 |
...................|..................|..................|...................
|           Mint 2 | $          74.18 | $          53.23 | $          52.73 |
...................|..................|..................|...................
|           Mint 3 | $          97.20 | $          55.26 | $          54.55 |
...................|..................|..................|...................
|           Mint 4 | $         120.22 | $          57.30 | $          56.36 |
...................|..................|..................|...................
|           Mint 5 | $         143.25 | $          59.33 | $          58.18 |
...................|..................|..................|...................
|         Transfer | $          56.24 | $          59.75 | $          59.57 |
...................|..................|..................|...................
|             Burn | $          17.64 | $          42.64 | $          51.53 |
·------------------|------------------|------------------|------------------·
</pre>

The following is an example gas report from the tests ran in this 
project and could change based on the cost of `ETH` itself.

<pre>
·-------------------------------------------------|---------------------------|-----------|-----------------------------·
|               Solc version: 0.8.9               ·  Optimizer enabled: true  ·  Runs: 1  ·  Block limit: 12450000 gas  │
··················································|···························|···········|······························
|  Methods                                        ·             300 gwei/gas              ·       3151.10 usd/eth       │
····························|·····················|·············|·············|···········|···············|··············
|  Contract                 ·  Method             ·  Min        ·  Max        ·  Avg      ·  # calls      ·  usd (avg)  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721AMockBurnable      ·  burn               ·          -  ·          -  ·    47380  ·            2  ·      44.79  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721AMockBurnable      ·  mint               ·      56890  ·      91090  ·    66355  ·           12  ·      62.73  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721AMockBurnable      ·  transferFrom       ·          -  ·          -  ·    66389  ·            2  ·      62.76  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BMockBurnable      ·  burn               ·          -  ·          -  ·    57262  ·            2  ·      54.13  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BMockBurnable      ·  mint               ·      56578  ·      90778  ·    65640  ·           12  ·      62.05  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BMockBurnable      ·  transferFrom       ·          -  ·          -  ·    66193  ·            2  ·      62.57  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BPresetAll         ·  burn               ·      42574  ·     111726  ·    75517  ·            4  ·      71.39  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BPresetAll         ·  mint               ·      68254  ·     106488  ·    87371  ·            2  ·      82.59  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BPresetAll         ·  pause              ·          -  ·          -  ·    30373  ·            1  ·      28.71  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BPresetAll         ·  setBaseTokenURI    ·          -  ·          -  ·    47264  ·            1  ·      44.68  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BPresetAll         ·  setTokenURI        ·          -  ·          -  ·    51860  ·            1  ·      49.02  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BPresetAll         ·  transferFrom       ·          -  ·          -  ·    88705  ·            1  ·      83.86  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BPresetAll         ·  unpause            ·          -  ·          -  ·    30146  ·            1  ·      28.50  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BPresetProvenance  ·  authorize          ·      78112  ·     133446  ·   105779  ·            2  ·     100.00  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BPresetProvenance  ·  mint               ·      67531  ·     109799  ·    97714  ·           14  ·      92.37  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BPresetProvenance  ·  withdraw           ·          -  ·          -  ·    55225  ·            2  ·      52.21  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BVanilla           ·  approve            ·          -  ·          -  ·    48698  ·            1  ·      46.04  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BVanilla           ·  mint               ·      78704  ·     103872  ·    86156  ·            5  ·      81.45  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BVanilla           ·  setApprovalForAll  ·          -  ·          -  ·    46400  ·            1  ·      43.86  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721BVanilla           ·  transferFrom       ·      49071  ·     105881  ·    68008  ·            3  ·      64.29  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721MockBurnable       ·  burn               ·          -  ·          -  ·    19611  ·            2  ·      18.54  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721MockBurnable       ·  mint               ·      56842  ·     159170  ·   105179  ·           12  ·      99.43  │
····························|·····················|·············|·············|···········|···············|··············
|  ERC721MockBurnable       ·  transferFrom       ·          -  ·          -  ·    62491  ·            2  ·      59.07  │
····························|·····················|·············|·············|···········|···············|··············
|  Deployments                                    ·                                       ·  % of limit   ·             │
··················································|·············|·············|···········|···············|··············
|  ERC721AMockBurnable                            ·          -  ·          -  ·  1330210  ·       10.7 %  ·    1257.49  │
··················································|·············|·············|···········|···············|··············
|  ERC721AMockVanilla                             ·          -  ·          -  ·  1210541  ·        9.7 %  ·    1144.36  │
··················································|·············|·············|···········|···············|··············
|  ERC721BMockBurnable                            ·          -  ·          -  ·  1153368  ·        9.3 %  ·    1090.31  │
··················································|·············|·············|···········|···············|··············
|  ERC721BMockVanilla                             ·          -  ·          -  ·  1054413  ·        8.5 %  ·     996.77  │
··················································|·············|·············|···········|···············|··············
|  ERC721BPresetAll                               ·          -  ·          -  ·  2482297  ·       19.9 %  ·    2346.59  │
··················································|·············|·············|···········|···············|··············
|  ERC721BPresetProvenance                        ·          -  ·          -  ·  2182949  ·       17.5 %  ·    2063.61  │
··················································|·············|·············|···········|···············|··············
|  ERC721BVanilla                                 ·          -  ·          -  ·  1186005  ·        9.5 %  ·    1121.17  │
··················································|·············|·············|···········|···············|··············
|  ERC721MockBurnable                             ·          -  ·          -  ·  1270258  ·       10.2 %  ·    1200.81  │
··················································|·············|·············|···········|···············|··············
|  ERC721MockVanilla                              ·          -  ·          -  ·  1208218  ·        9.7 %  ·    1142.16  │
·-------------------------------------------------|-------------|-------------|-----------|---------------|-------------·
</pre>
